---
date: '2015-08-27 14:20:00'
layout: post
slug: intellij-and-java
published: false
title: IntelliJ IDEA and Java 6
authors:
  - bjorn
categories:
---

@: IntelliJ IDEA plugin development and Java 6

Based on my experience of the last couple of years writing editor plugins for Floobits, IntelliJ IDEA’s plugin system is phenomenal. Extending IntelliJ IDEA seems particularly stellar when compared to other editors. As plugin developer, with IntelliJ you have access to everything. The IDE architecture is very well designed, the core source code is open source and easy to follow and you have all of Java's libraries to make use of to build your plugin. It is quite amazing. There is a lot to rave about, but one of the things that isn’t great is Java versioning. IntelliJ IDEA is a cross-platform Java based editor, and its plugins must share the JRE that the editor runs on. The version of Java you choose for writing your plugin must be compatible with your target audience’s installed Java version. If the user does not have the correct version of Java your plugin will cause a nasty error at start time and your plugin will be automatically disabled. There is no way to specify in the plugin configuration file, the `plugin.xml` file, which version of Java you support to prevent people from installing something that will explode on them. There’s also no easy way to explain to the user when they run into an error what happened or what they could do about it.

Jetbrains recommends Java 6 for plugin IntelliJ IDEA development, but Java 6 is a very old version of Java that Oracle has abandoned. On Oracle’s website it warns that Java 6 is no longer supported, it no longer receives security updates. Compared to Java 8 and even Java 7, Java 6 is terrible to work with. There are no lambdas, and none of the new `nio` APIs that make working with file I/O and threads less painful. I looked into why Java 6 is the recommended version, since probably most people are running at least Java 7 now. However, it turns out at least for OS X users, Java 6 is what most people have, if they even have Java at all. Apple used to develop their own version of Java for OS X, but they gave it up, and the last version they supported was Java 6. Apple still makes this old version available, and it still gets security updates, but Apple refers to it as ‘legacy’ and has no plans to build any new versions. Oracle does supply newer versions of Java that are OS X compatible, but they have a severe problem: the font-rendering is atrocious on OS X. This is a huge problem for an IDE! Blurry pixelated, aliased fonts are not what you want to stare at for hours at end. Oracle is looking to fix this for newer versions of Java, but for now we are stuck with Java 6.

Given this dire state of Java on OS X, Jetbrains has done something pretty great. They forked OpenJDK, fixed the font-rendering issue in it for OS X, and offer a version of each of their IntelliJ IDEA based editors that includes this version of Java. Unfortunately, this version is not the default and to even know it exists requires clicking through a link for “previous releases” when in actuality you get a page that has all the releases, including current versions with the embedded Java. In my opinion this version of IntelliJ IDEA should be the default version for all OS X users, with the version that doesn’t include the additional run time as an option. This is not the case, but even if it were there would still be many current installs that still rely on Java 6. So for now, plugins must be written to match the lowest common denominator, the JRE for Java 6.

When I asked about Java version detection on the Jetbrains plugin development forum I was told that there was no such thing and no plans for it, and that if I wanted new things like lambdas that I should develop plugins using Kotlin. We already have a very large Java based project, but if we were to start building the plugin now we would probably use Kotlin. Kotlin is a pretty amazing programing language. Kotlin gives you lambdas, and many modern programming language concepts, such as null-pointer saftey, first class functions and more. It does this without making it difficult to use libraries and code written in Java. Yet, even if we used Kotlin we would still not have access to the `nio` APIs, but the situation would be better.

The takeaway is that whenever we build plugins we run into issues that probably saner developers look at, throw their hands up and walk away from, abandoning the project. We can’t afford that, so Java 6 it is, unfortunately. In order to bring Floobits to as many editors and platforms possible, we have to endure the pain that is editor plugin development. Having said that, IntelliJ IDEA actually has the best plugin development API out there and this post doesn’t mean to detract from that.
